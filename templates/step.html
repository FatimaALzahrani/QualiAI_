{% extends "base.html" %} {% block content %}
<div class="container mt-5" dir="rtl">
  <!-- ุดุฑูุท ุฎุทูุงุช ุงูุชูุฏู -->
  <div
    class="steps-horizontal mb-4 d-flex align-items-center justify-content-between"
  >
    {% set labels = ["ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ", "ููู ุงูุจุฑูุงูุฌ", "ุงูุฏุฑุงุณุฉ ุงูุฐุงุชูุฉ
    ููุจุฑูุงูุฌ", "ุงูุชูููู ุงูุฐุงุชู ููู ูุนุงููุฑ ุงูุงุนุชูุงุฏ"] %} {% for step in range(1,
    total_steps + 1) %}
    <div class="step-horizontal text-center">
      <div
        class="step-icon mb-2"
        style="color:{% if step <= step_number %}#fff{% else %}#000{% endif %};;background: {% if step < step_number %}#377E47{% elif step == step_number %}#000C7B{% else %}#ccc{% endif %};"
      >
        {% if step < step_number %}
        <i class="fas fa-check"></i>
        {% else %} {{ step }} {% endif %}
      </div>
      <div
        class="step-title"
        style="color: {% if step < step_number %}#377E47{% elif step == step_number %}#000C7B{% else %}#666{% endif %};"
      >
        {{ step }}: {{ labels[step-1] }}
      </div>
    </div>
    {% endfor %}
  </div>
  <!-- 
  {% if step_number == total_steps %}
  ุนุฑุถ ุงูููุงุท ุงูุชูุตูููุฉ ุนูุฏ ุงูุฎุทูุฉ ุงูุฑุงุจุนุฉ 
  <div class="mb-4 text-center">
    <ul
      class="list-inline"
      style="
        list-style-type: disc;
        display: inline-block;
        text-align: right;
        padding-right: 20px;
        font-size: 16px;
        color: #007bff;
      "
    >
      <li>ุชูููู ุงูุฃุฏุงุก ุงูุนุงู</li>
      <li>ุฅุจุฑุงุฒ ููุงุท ุงูููุฉ</li>
      <li>ุชุญุฏูุฏ ูุฌุงูุงุช ุงูุชุญุณูู</li>
    </ul>
  </div>
  {% endif %}-->

  <!-- ุญุงููุฉ ุงููููุฐุฌ -->
  <div class="card shadow">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">
        {% if step_number == 1 %} ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ {% elif step_number == 2 %}
        ููู ุงูุจุฑูุงูุฌ {% elif step_number == 3 %} ุงูุฏุฑุงุณุฉ ุงูุฐุงุชูุฉ ููุจุฑูุงูุฌ {%
        elif step_number == 4 %} ุงูุชูููู ุงูุฐุงุชู ููู ูุนุงููุฑ ุงูุงุนุชูุงุฏ {% endif %}
      </h4>
    </div>
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        {% if step_number == 1 %}

        <!-- ุจูุงูุงุช ุงููุคุณุณุฉ ูุงูุงุชุตุงู -->
        <div class="form-group">
          <label for="title">ุนููุงู ุงูุชูุฑูุฑ</label>
          <input
            type="text"
            class="form-control"
            id="title"
            name="title"
            required
            value="{{ data.get('title', '') }}"
          />
        </div>
        <div class="form-group">
          <label for="institution">ุงููุคุณุณุฉ</label>
          <input
            type="text"
            class="form-control"
            id="institution"
            name="institution"
            required
            value="{{ data.get('institution', '') }}"
          />
        </div>
        <div class="form-group">
          <label for="college">ุงููููุฉ</label>
          <input
            type="text"
            class="form-control"
            id="college"
            name="college"
            required
            value="{{ data.get('college', '') }}"
          />
        </div>
        <div class="form-group">
          <label for="department">ุงููุณู ุงูุนููู</label>
          <input
            type="text"
            class="form-control"
            id="department"
            name="department"
            required
            value="{{ data.get('department', '') }}"
          />
        </div>
        <div class="form-group">
          <label for="program">ุงูุจุฑูุงูุฌ</label>
          <input
            type="text"
            class="form-control"
            id="program"
            name="program"
            required
            value="{{ data.get('program', '') }}"
          />
        </div>
        <div class="form-group">
          <label for="reportDate">ุชุงุฑูุฎ ุฅุนุฏุงุฏ ุงูุชูุฑูุฑ</label>
          <input
            type="date"
            class="form-control"
            id="reportDate"
            name="reportDate"
            required
            value="{{ data.get('reportDate', '') }}"
          />
        </div>
        <hr />
        <!-- ุจูุงูุงุช ุงูุชูุงุตู -->
        <h3>ุจูุงูุงุช ุงูุชูุงุตู</h3>
        <div class="form-group">
          <label for="contactName">ุงูุงุณู</label>
          <input
            type="text"
            class="form-control"
            id="contactName"
            name="contactName"
            required
            value="{{ data.get('contactName', '') }}"
          />
        </div>
        <div class="form-group">
          <label for="position">ุงูููุตุจ</label>
          <input
            type="text"
            class="form-control"
            id="position"
            name="position"
            required
            value="{{ data.get('position', '') }}"
          />
        </div>
        <div class="form-group">
          <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
          <input
            type="email"
            class="form-control"
            id="email"
            name="email"
            required
            value="{{ data.get('email', '') }}"
          />
        </div>
        <div class="form-group">
          <label for="phone">ุงููุงุชู ุงูุฌูุงู</label>
          <input
            type="tel"
            class="form-control"
            id="phone"
            name="phone"
            required
            value="{{ data.get('phone', '') }}"
          />
        </div>

        {% elif step_number == 2 %}
        <!-- ููู ุงูุจุฑูุงูุฌ -->
        <div class="card-body">
          <!-- ูุณู ุงููุนูููุงุช ุงูุนุงูุฉ ููุจุฑูุงูุฌ -->
          <h3 class="card-title">ุงููุนูููุงุช ุงูุนุงูุฉ ููุจุฑูุงูุฌ</h3>
          <div class="form-group">
            <label for="program_message">ุฑุณุงูุฉ ุงูุจุฑูุงูุฌ</label>
            <textarea
              class="form-control"
              id="program_message"
              name="program_message"
              rows="2"
              required
            >
{{ data.get('program_message', '') }}</textarea
            >
          </div>
          <div class="form-group">
            <label for="program_objectives">ุฃูุฏุงู ุงูุจุฑูุงูุฌ</label>
            <textarea
              class="form-control"
              id="program_objectives"
              name="program_objectives"
              rows="2"
              required
            >
{{ data.get('program_objectives', '') }}</textarea
            >
          </div>
          <div class="form-group">
            <label for="program_achievements">ุฅูุฌุงุฒุงุช ุงูุจุฑูุงูุฌ ูุงูุฌูุงุฆุฒ</label>
            <textarea
              class="form-control"
              id="program_achievements"
              name="program_achievements"
              rows="2"
              required
            >
{{ data.get('program_achievements', '') }}</textarea
            >
          </div>
          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="program_hours">ุฅุฌูุงูู ุงูุณุงุนุงุช ุงููุนุชูุฏุฉ</label>
              <input
                type="number"
                class="form-control"
                id="program_hours"
                name="program_hours"
                required
                value="{{ data.get('program_hours', '') }}"
              />
            </div>
            <div class="form-group col-md-4">
              <label for="program_tracks_count"
                >ุนุฏุฏ ุงููุณุงุฑุงุช ุงูุฑุฆูุณูุฉ ููุจุฑูุงูุฌ</label
              >
              <input
                type="number"
                class="form-control"
                id="program_tracks_count"
                name="program_tracks_count"
                min="1"
                value="1"
                required
              />
            </div>
            <div class="form-group col-md-8">
              <label>ุชูุงุตูู ุงููุณุงุฑุงุช ุงูุฑุฆูุณูุฉ ููุจุฑูุงูุฌ</label>
              <table class="table table-bordered" id="tracksTable">
                <thead>
                  <tr>
                    <th>ุฑูู ุงููุณุงุฑ</th>
                    <th>ุงุณู ุงููุณุงุฑ</th>
                    <th>ุฅุฌูุงูู ุงูุณุงุนุงุช ุงููุนุชูุฏุฉ</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- ุณูุชู ุชูููุฏ ุงูุตููู ุนุจุฑ JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="form-group col-md-4">
              <label for="program_qualification_count"
                >ุนุฏุฏ ููุงุท ุงูุฎุฑูุฌ / ุงููุคูู ุงูููููุญ</label
              >
              <input
                type="number"
                class="form-control"
                id="program_qualification_count"
                name="program_qualification_count"
                min="1"
                value="1"
                required
              />
            </div>
            <div class="form-group col-md-8">
              <label>ุชูุงุตูู ุงููุคูู ุงูููููุญ / ููุงุท ุงูุฎุฑูุฌ</label>
              <table class="table table-bordered" id="qualificationTable">
                <thead>
                  <tr>
                    <th>ุฑูู ููุทุฉ ุงูุฎุฑูุฌ</th>
                    <th>ุงุณู ุงูููุทุฉ</th>
                    <th>ุฅุฌูุงูู ุงูุณุงุนุงุช ุงููุนุชูุฏุฉ</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- ุณูุชู ุชูููุฏ ุงูุตููู ุนุจุฑ JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="form-group">
            <label for="program_progress">ุงููุฑูุน ุงูุชู ููุฏููุง ุงูุจุฑูุงูุฌ</label>
            <textarea
              class="form-control"
              id="program_progress"
              name="program_progress"
              rows="2"
              required
            >
{{ data.get('program_progress', '') }}</textarea
            >
          </div>
          <hr />
          <h3 class="card-title">ุงูุจูุงูุงุช ุงูุฅุญุตุงุฆูุฉ ููุจุฑูุงูุฌ ุงูุฃูุงุฏููู</h3>
          <div class="form-group">
            <label for="excel_students">ุชุญููู ุฌุฏูู ุฃุนุฏุงุฏ ุงูุทูุงุจ</label>
            <a
              href="{{ url_for('static', filename='templates/template_students.xlsx') }}"
              target="_blank"
              class="btn btn-link"
              >ุชุญููู ุงููุซุงู</a
            >
            <input
              type="file"
              class="form-control-file"
              id="excel_students"
              name="excel_students"
              accept=".xlsx,.xls"
              required
            />
          </div>
          <div class="form-group">
            <label for="excel_enrollment">ุชุญููู ุฌุฏูู ุฅุญุตุงุฆูุงุช ุงูููุชุญููู</label>
            <a
              href="{{ url_for('static', filename='templates/template_enrollment.xlsx') }}"
              target="_blank"
              class="btn btn-link"
              >ุชุญููู ุงููุซุงู</a
            >
            <input
              type="file"
              class="form-control-file"
              id="excel_enrollment"
              name="excel_enrollment"
              accept=".xlsx,.xls"
              required
            />
          </div>
          <div class="form-group">
            <label for="excel_graduates">ุชุญููู ุฌุฏูู ุฃุนุฏุงุฏ ุงูุฎุฑูุฌูู</label>
            <a
              href="{{ url_for('static', filename='templates/template_graduates.xlsx') }}"
              target="_blank"
              class="btn btn-link"
              >ุชุญููู ุงููุซุงู</a
            >
            <input
              type="file"
              class="form-control-file"
              id="excel_graduates"
              name="excel_graduates"
              accept=".xlsx,.xls"
              required
            />
          </div>
          <div class="form-group">
            <label for="excel_additional">ุชุญููู ุฌุฏูู ููุฆุฉ ุงูุชุฏุฑูุณ</label>
            <a
              href="{{ url_for('static', filename='templates/template_faculty.xlsx') }}"
              target="_blank"
              class="btn btn-link"
              >ุชุญููู ุงููุซุงู</a
            >
            <input
              type="file"
              class="form-control-file"
              id="excel_additional"
              name="excel_additional"
              accept=".xlsx,.xls"
              required
            />
          </div>
          <hr />
        </div>
        {% elif step_number == 3 %}
        <!-- ุงูุฏุฑุงุณุฉ ุงูุฐุงุชูุฉ ููุจุฑูุงูุฌ -->
        <div class="card-body">
          <!-- 2.1 ุฌูุงุช ุงูููุงุฑูุฉ ูุณุจุจ ุงุฎุชูุงุฑูุง -->
          <h3 class="card-title">
            2.1 ุฌูุงุช ุงูููุงุฑูุฉ ูุณุจุจ ุงุฎุชูุงุฑูุง (ุฏุงุฎูููุง ุฃู ุฎุงุฑุฌููุง)
          </h3>
          <div class="form-group">
            <label for="comparison_file">ุฑูุน ููู ุฌูุงุช ุงูููุงุฑูุฉ</label>
            <input
              type="file"
              class="form-control-file"
              id="comparison_file"
              name="comparison_file"
              accept=".xlsx, .xls"
              required
            />
            <a
              href="{{ url_for('static', filename='templates/template_comparison.xlsx') }}"
              target="_blank"
              class="btn btn-link"
              >ุชุญููู ูููุฐุฌ ุฌุงูุฒ</a
            >
          </div>
          <!-- 2.2 ููุฎุต ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณุฉ ูุงูููุงุฑูุฉ ุงููุฑุฌุนูุฉ -->
          <h3 class="card-title mt-4">
            2.2 ููุฎุต ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณุฉ ูุงูููุงุฑูุฉ ุงููุฑุฌุนูุฉ
          </h3>
          <div class="form-group">
            <label for="indicators_file">ุฑูุน ููู ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณุฉ</label>
            <input
              type="file"
              class="form-control-file"
              id="indicators_file"
              name="indicators_file"
              accept=".xlsx, .xls"
              required
            />
            <a
              href="{{ url_for('static', filename='templates/template_indicators.xlsx') }}"
              target="_blank"
              class="btn btn-link"
              >ุชุญููู ูููุฐุฌ ุฌุงูุฒ</a
            >
          </div>
        </div>
        {% elif step_number == 4 %}
        <div class="stepper-container">
          <div class="steps">
            {% for standard_title, required_files in standards_files.items() %}
            <div
              class="step {% if not loop.first %}minimized{% endif %}"
              data-step="{{ loop.index }}"
            >
              <div class="step-header">
                <div class="step-marker">{{ loop.index }}</div>
                <div class="step-info">
                  <h3 class="step-name">{{ standard_title }}</h3>
                </div>
              </div>
              <div class="step-content">
                <p class="content-title">๐ ุงููููุงุช ุงููุทููุจุฉ:</p>
                <ul class="content-list">
                  {% for f in required_files %}
                  <li>{{ f }}</li>
                  {% endfor %}
                </ul>
                <div class="form-group">
                  <label for="files_{{ loop.index }}">๐ ุชุญููู ุงููููุงุช:</label>
                  <input
                    type="file"
                    class="form-control-file"
                    id="files_{{ loop.index }}"
                    name="files_{{ loop.index }}"
                    multiple
                  />
                  <small class="form-text"
                    >ูููู ุฑูุน ุฃูุซุฑ ูู ููู (PDFุ Excelุ Wordุ ุฅูุฎ). ุงูุญุฏ ุงูุฃูุตู
                    10 ูููุงุช.</small
                  >
                </div>

                <div class="step-controls">
                  {% if loop.index > 1 %}
                  <button
                    type="button"
                    class="btn prev-btn"
                    onclick="toggleStep({{ loop.index }}, 'prev')"
                  >
                    ุงูุณุงุจู
                  </button>
                  {% endif %} {% if loop.index < standards_files|length %}
                  <button
                    type="button"
                    class="btn next-btn"
                    onclick="toggleStep({{ loop.index }}, 'next')"
                  >
                    ุงูุชุงูู
                  </button>
                  {% else %}
                  <button
                    type="button"
                    class="btn close-btn"
                    onclick="toggleStep({{ loop.index }}, 'close')"
                  >
                    ุฅุบูุงู
                  </button>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>
          // ุงุณุชุฎุฏุงู jQuery ููุชุฃุซูุฑุงุช
          $(document).ready(function () {
            // ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ "ุงูุชุงูู" ุฃู "ุงูุณุงุจู"
            window.toggleStep = function (currentIndex, action) {
              let currentStep = $('.step[data-step="' + currentIndex + '"]');
              let targetStep;
              if (action === "next") {
                targetStep = currentStep.next(".step");
              } else if (action === "prev") {
                targetStep = currentStep.prev(".step");
              } else if (action === "close") {
                // ุนูุฏ ุงูุถุบุท ุนูู ุฅุบูุงูุ ููุท ูุชู ุทู ุงูุฎุทูุฉ ุงูุญุงููุฉ
                currentStep.find(".step-content").slideUp(300, function () {
                  $(this).addClass("minimized");
                });
                return;
              }
              if (targetStep.length) {
                // ุทู ุงูุฎุทูุฉ ุงูุญุงููุฉ ุซู ูุชุญ ุงููุฏู
                currentStep.find(".step-content").slideUp(300, function () {
                  $(this).addClass("minimized");
                  targetStep.find(".step-content").slideDown(300, function () {
                    $(this).removeClass("minimized");
                  });
                });
              }
            };

            // ุงูููุฑ ุนูู ุงูุฑุฃุณ ููุชุญ ุงูุฎุทูุฉ ุฅุฐุง ูุงูุช ูุบููุฉ
            $(".step-header").on("click", function () {
              let step = $(this).closest(".step");
              if (step.hasClass("minimized")) {
                // ุฅุบูุงู ุฃู ุฎุทูุฉ ููุชูุญุฉ ุฃุฎุฑู\n        $('.step-content').slideUp(300).addClass('minimized');
                step.find(".step-content").slideDown(300, function () {
                  $(this).removeClass("minimized");
                });
              }
            });
          });
        </script>
        {% endif %}

        <!-- ุนูุงุตุฑ ุงูุชููู ุจูู ุงูุฎุทูุงุช -->
        <div class="form-navigation mt-4 clearfix">
          <div class="float-right">
            {% if step_number > 1 %}
            <a
              href="{{ url_for('step', step_number=step_number-1) }}"
              class="btn btn-secondary"
              ><i class="fas fa-arrow-right"></i> ุงูุณุงุจู</a
            >
            {% endif %}
          </div>
          <div class="float-left">
            <button type="submit" class="btn btn-primary">
              {% if step_number < total_steps %} ุงูุชุงูู
              <i class="fas fa-arrow-left"></i> {% else %} ุฅููุงุก ูุชูููุฏ ุงูุชูุฑูุฑ
              <i class="fas fa-file-pdf"></i>
              {% endif %}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
  {% endblock %}
</div>
